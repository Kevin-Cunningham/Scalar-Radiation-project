(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     10679,        297]
NotebookOptionsPosition[     10067,        279]
NotebookOutlinePosition[     10537,        297]
CellTagsIndexPosition[     10494,        294]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{"<<", "KerrGeodesics`"}], "\[IndentingNewLine]", 
 RowBox[{"<<", "SpinWeightedSpheroidalHarmonics`"}]}], "Input",
 CellChangeTimes->{{3.848736441254277*^9, 3.848736458590831*^9}, {
  3.8526092663447323`*^9, 3.8526092679589453`*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"df6eb2bb-3780-4af4-bb5d-747a75dee4df"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"dtd\[Lambda]", "[", 
    RowBox[{
    "M_", ",", "a_", ",", "r_", ",", "\[ScriptCapitalE]_", ",", 
     "\[ScriptCapitalL]_", ",", "\[Theta]_"}], "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"\[ScriptCapitalE]", 
     RowBox[{"(", 
      RowBox[{
       FractionBox[
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           SuperscriptBox["r", "2"], "+", 
           SuperscriptBox["a", "2"]}], ")"}], "2"], 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["r", "2"], "-", 
          RowBox[{"2", " ", "M", " ", "r"}], "+", 
          SuperscriptBox["a", "2"]}], ")"}]], "-", 
       RowBox[{
        SuperscriptBox["a", "2"], 
        SuperscriptBox[
         RowBox[{"Sin", "[", "\[Theta]", "]"}], "2"]}]}], ")"}]}], "+", 
    RowBox[{"a", " ", "\[ScriptCapitalL]", 
     RowBox[{"(", 
      RowBox[{"1", "-", 
       FractionBox[
        RowBox[{
         SuperscriptBox["r", "2"], "+", 
         SuperscriptBox["a", "2"]}], 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["r", "2"], "-", 
          RowBox[{"2", "M", " ", "r"}], "+", 
          SuperscriptBox["a", "2"]}], ")"}]]}], ")"}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"gtt", "[", 
    RowBox[{"M_", ",", "a_", ",", "r_", ",", "\[Theta]_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{
      SuperscriptBox["a", "4"], "+", 
      RowBox[{"2", " ", 
       SuperscriptBox["r", "4"]}], "+", 
      RowBox[{
       SuperscriptBox["a", "2"], " ", "r", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"2", " ", "M"}], "+", 
         RowBox[{"3", " ", "r"}]}], ")"}]}], "+", 
      RowBox[{
       SuperscriptBox["a", "2"], " ", 
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["a", "2"], "+", 
         RowBox[{"r", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "2"}], " ", "M"}], "+", "r"}], ")"}]}]}], ")"}], 
       " ", 
       RowBox[{"Cos", "[", 
        RowBox[{"2", " ", "\[Theta]"}], "]"}]}]}], 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["a", "2"], "+", 
        RowBox[{"r", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", "M"}], "+", "r"}], ")"}]}]}], ")"}], " ", 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["a", "2"], "+", 
        RowBox[{"2", " ", 
         SuperscriptBox["r", "2"]}], "+", 
        RowBox[{
         SuperscriptBox["a", "2"], " ", 
         RowBox[{"Cos", "[", 
          RowBox[{"2", " ", "\[Theta]"}], "]"}]}]}], ")"}]}]]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"gt\[Phi]", "[", 
    RowBox[{"M_", ",", "a_", ",", "r_", ",", "\[Theta]_"}], "]"}], ":=", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{"4", " ", "a", " ", "M", " ", "r"}], 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["a", "2"], "+", 
        RowBox[{"r", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", "M"}], "+", "r"}], ")"}]}]}], ")"}], " ", 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["a", "2"], "+", 
        RowBox[{"2", " ", 
         SuperscriptBox["r", "2"]}], "+", 
        RowBox[{
         SuperscriptBox["a", "2"], " ", 
         RowBox[{"Cos", "[", 
          RowBox[{"2", " ", "\[Theta]"}], "]"}]}]}], ")"}]}]]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ut", "[", 
    RowBox[{
    "M_", ",", "a_", ",", "r_", ",", "\[ScriptCapitalE]_", ",", 
     "\[ScriptCapitalL]_", ",", "\[Theta]_"}], "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"gt\[Phi]", "[", 
      RowBox[{"M", ",", "a", ",", "r", ",", "\[Theta]"}], "]"}], " ", 
     "\[ScriptCapitalL]"}], "-", " ", 
    RowBox[{
     RowBox[{"gtt", "[", 
      RowBox[{"M", ",", "a", ",", "r", ",", "\[Theta]"}], "]"}], " ", 
     "\[ScriptCapitalE]"}]}]}], ";"}]}], "Input",ExpressionUUID->"16504df9-\
02ae-4d08-b8f4-63018898fa72"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SourceNonZero", "[", 
   RowBox[{
   "l_", ",", "m_", ",", "k_", ",", "M_", ",", "a_", ",", "r0_", ",", "xi_"}],
    "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ly", "=", "l"}], ",", 
      RowBox[{"my", "=", "m"}], ",", 
      RowBox[{"ky", "=", "k"}], ",", 
      RowBox[{"My", "=", "M"}], ",", 
      RowBox[{"ay", "=", "a"}], ",", 
      RowBox[{"r0y", "=", "r0"}], ",", 
      RowBox[{"xiy", "=", "xi"}], ",", "\[CapitalDelta]", ",", 
      "\[ScriptCapitalE]", ",", "\[ScriptCapitalL]", ",", "\[ScriptCapitalQ]",
       ",", "\[CapitalOmega]\[Theta]", ",", "\[CapitalOmega]\[Phi]", ",", 
      "\[CapitalUpsilon]", ",", "\[Lambda]", ",", "Freqs", ",", "tp", ",", 
      "rp", ",", "\[Theta]p", ",", "\[Phi]p", ",", "orbit", ",", "Integrand", 
      ",", "Ans", ",", "S"}], "}"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"orbit", " ", "=", " ", 
      RowBox[{"KerrGeoOrbit", "[", 
       RowBox[{"ay", ",", "r0y", ",", "0", ",", "xiy"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tp", ",", "rp", ",", "\[Theta]p", ",", "\[Phi]p"}], "}"}], 
      "=", 
      RowBox[{"orbit", "[", "\"\<Trajectory\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"\[CapitalDelta]", "=", 
      RowBox[{
       SuperscriptBox["r0y", "2"], "-", 
       RowBox[{"2", "My", " ", "r0y"}], " ", "+", " ", 
       SuperscriptBox["ay", "2"]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"\[ScriptCapitalE]", "=", 
      RowBox[{"orbit", "[", "\"\<Energy\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[ScriptCapitalL]", "=", 
      RowBox[{"orbit", "[", "\"\<AngularMomentum\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[CapitalUpsilon]", " ", "=", 
      RowBox[{
       RowBox[{"orbit", "[", "\"\<Frequencies\>\"", "]"}], "[", 
       "\"\<\!\(\*SubscriptBox[\(\[CapitalUpsilon]\), \(\[Theta]\)]\)\>\"", 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Freqs", " ", "=", " ", 
      RowBox[{"KerrGeoFrequencies", "[", 
       RowBox[{"ay", ",", "r0y", ",", "0", ",", "xiy"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[CapitalOmega]\[Theta]", " ", "=", " ", 
      RowBox[{"Freqs", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[CapitalOmega]\[Phi]", " ", "=", " ", 
      RowBox[{"Freqs", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"S", "=", 
      RowBox[{"SpinWeightedSpheroidalHarmonicS", "[", 
       RowBox[{"0", ",", "ly", ",", "my", ",", 
        RowBox[{"ay", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"m", " ", "\[CapitalOmega]\[Phi]"}], "-", 
           RowBox[{"k", " ", "\[CapitalOmega]\[Theta]"}]}], ")"}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Integrand", ":=", 
      RowBox[{
       FractionBox[
        RowBox[{"S", "[", 
         RowBox[{
          RowBox[{"\[Theta]p", "[", "\[Lambda]", "]"}], ",", "0"}], "]"}], 
        RowBox[{"ut", "[", 
         RowBox[{
         "My", ",", "ay", ",", "r0y", ",", "\[ScriptCapitalE]", ",", 
          "\[ScriptCapitalL]", ",", 
          RowBox[{"\[Theta]p", "[", "\[Lambda]", "]"}]}], "]"}]], 
       RowBox[{"Cos", "[", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"m", " ", "\[CapitalOmega]\[Phi]"}], "-", 
             RowBox[{"k", " ", "\[CapitalOmega]\[Theta]"}]}], ")"}], " ", 
           RowBox[{"tp", "[", "\[Lambda]", "]"}]}], "-", 
          RowBox[{"my", " ", 
           RowBox[{"\[Phi]p", "[", "\[Lambda]", "]"}]}]}], ")"}], "]"}], 
       RowBox[{"dtd\[Lambda]", "[", 
        RowBox[{
        "My", ",", "ay", ",", "r0y", ",", "\[ScriptCapitalE]", ",", 
         "\[ScriptCapitalL]", ",", 
         RowBox[{"\[Theta]p", "[", "\[Lambda]", "]"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Ans", "=", 
      RowBox[{
       RowBox[{"-", 
        FractionBox[
         RowBox[{" ", 
          RowBox[{"2", "\[CapitalOmega]\[Theta]", " ", "r0y"}]}], 
         RowBox[{"\[CapitalDelta]", " "}]]}], " ", 
       RowBox[{"NIntegrate", "[", 
        RowBox[{"Integrand", ",", 
         RowBox[{"{", 
          RowBox[{"\[Lambda]", ",", "0", ",", 
           FractionBox[
            RowBox[{"2", "\[Pi]"}], "\[CapitalUpsilon]"]}], "}"}], ",", 
         RowBox[{"Method", "->", "\"\<Trapezoidal\>\""}], ",", 
         RowBox[{"PrecisionGoal", "\[Rule]", "30"}]}], 
        RowBox[{"(*", 
         RowBox[{",", 
          RowBox[{"MaxRecursion", "->", "30"}]}], "*)"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "Ans"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",ExpressionUUID->"8763e4f9-0cc3-\
4068-931e-aaa85866ce2c"]
},
Evaluator->"local4",
WindowSize->{576., 580.8},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
TaggingRules->Association["TryRealOnly" -> False],
FrontEndVersion->"12.3 for Microsoft Windows (64-bit) (July 9, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"96398034-5a1f-41f7-a3a7-129ef8b7ee20"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 334, 5, 48, "Input",ExpressionUUID->"df6eb2bb-3780-4af4-bb5d-747a75dee4df"],
Cell[895, 27, 4085, 129, 216, "Input",ExpressionUUID->"16504df9-02ae-4d08-b8f4-63018898fa72"],
Cell[4983, 158, 5080, 119, 648, "Input",ExpressionUUID->"8763e4f9-0cc3-4068-931e-aaa85866ce2c"]
}
]
*)

(* End of internal cache information *)

